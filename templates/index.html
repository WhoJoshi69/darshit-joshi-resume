<!DOCTYPE html>
<html>
<head>
    <title>LaTeX Resume Editor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        .tab { padding: 10px 20px; cursor: pointer; border: none; background: #f5f5f5; }
        .tab.active { background: #007bff; color: white; }
        .editor { width: 100%; height: 400px; font-family: monospace; }
        .buttons { margin: 20px 0; }
        button { padding: 10px 20px; margin-right: 10px; cursor: pointer; }
        .save { background: #28a745; color: white; border: none; }
        .generate { background: #007bff; color: white; border: none; }
        .download { background: #17a2b8; color: white; border: none; }
        .message { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>LaTeX Resume Editor</h1>
        
        <div class="tabs">
            {% for section in sections %}
            <button class="tab" onclick="loadSection('{{ section }}')">{{ section.title() }}</button>
            {% endfor %}
        </div>
        
        <div class="buttons">
            <button class="save" onclick="saveFile()">Save</button>
            <button class="generate" onclick="generatePDF()">Generate PDF</button>
            <button class="download" onclick="downloadPDF()">Download PDF</button>
        </div>
        
        <div id="message"></div>
        
        <textarea id="editor" class="editor" placeholder="Select a section to edit..."></textarea>
    </div>

    <script>
        let currentSection = '';
        
        function loadSection(section) {
            currentSection = section;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            fetch(`/get_file/${section}`)
                .then(r => r.json())
                .then(data => {
                    if (data.content) {
                        document.getElementById('editor').value = data.content;
                    } else {
                        showMessage('Error loading file: ' + data.error, 'error');
                    }
                });
        }
        
        function saveFile() {
            if (!currentSection) {
                showMessage('Please select a section first', 'error');
                return;
            }
            
            const content = document.getElementById('editor').value;
            fetch(`/save_file/${currentSection}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({content})
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    showMessage('File saved successfully', 'success');
                } else {
                    showMessage('Error saving file: ' + data.error, 'error');
                }
            });
        }
        
        function generatePDF() {
            showMessage('Generating PDF...', 'success');
            fetch('/generate_pdf', {method: 'POST'})
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        showMessage('PDF generated successfully', 'success');
                    } else {
                        showMessage('Error generating PDF: ' + data.error, 'error');
                    }
                });
        }
        
        function downloadPDF() {
            window.open('/download_pdf', '_blank');
        }
        
        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type}`;
            setTimeout(() => msg.textContent = '', 3000);
        }
        
        // Load first section by default
        if (document.querySelector('.tab')) {
            document.querySelector('.tab').click();
        }
    </script>
</body>
</html>